<!DOCTYPE html>
<html lang="en">
<head>
    <!-- Required meta tags -->
    <title>my page</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta charset="UTF-8">
    <link rel="stylesheet" type="text/css" href="css/style.css">
    <script>
        function View(){
            document.getElementById("body").style.overflow="hidden";
            document.getElementById("levelLayout").style.display='inline';

        }
        function Close(){
            document.getElementById("body").style.overflow="auto";
            document.getElementById("levelLayout").style.display='none';
        }
    </script>
</head>
<body id="body">
<div class="frame_mypage" style="position: absolute;">
    <div class = "header">
        <a href="01_0_main.html">
            <img src="img/ic-back@2x.png"
                layout="responsive"
                class="ic_back">
        </a>
        <span class="header_title">마이페이지</span>
    </div>
    <div class="content_mypage">
        <div class="current_status">
            <div class="img_current_status">
                <img class="ic_level">
                <a href="javascript:View();"><img src="img/ic-help@2x.png" class="ic_help"></a>
            </div>
            <div class="name_current_status"></div>
            <div class="points_current_status"></div>
            <div class="bar_current_status">
                <div class="done_current_status"></div>
            </div>
        </div>
        <div class="rec1_mypage">
            <span class="rec1_title_mypage">달성률</span>
            <a href="02_2_1_qCheckListG.html">
                <div class="rec2_mypage">
                    <div class="rec2_title_mypage">경복궁</div>
                    <div class="rec2_points_mypage" id="gyeongbok_mypage"></div>
                    <div class="rec2_bar_mypage">
                        <div class="rec2_doneG_mypage"></div>
                    </div>
                </div>
            </a>
            <a href="02_2_1_qCheckListCha.html">
                <div class="rec2_mypage">
                    <div class="rec2_title_mypage">창경궁</div>
                    <div class="rec2_points_mypage" id="changgyeong_mypage"></div>
                    <div class="rec2_bar_mypage">
                        <div class="rec2_doneCha_mypage"></div>
                    </div>
                </div>
            </a>
            <a href="02_2_1_qCheckListD.html">
                <div class="rec2_mypage">
                    <div class="rec2_title_mypage">덕수궁</div>
                    <div class="rec2_points_mypage" id="deoksu_mypage"></div>
                    <div class="rec2_bar_mypage">
                        <div class="rec2_doneD_mypage"></div>
                    </div>
                </div>
            </a>
            <a href="02_2_1_qCheckListCdg.html">
                <div class="rec2_mypage">
                    <div class="rec2_title_mypage">창덕궁</div>
                    <div class="rec2_points_mypage" id="changdeok_mypage"></div>
                    <div class="rec2_bar_mypage">
                        <div class="rec2_doneCdg_mypage"></div>
                    </div>
                </div>
            </a>
        </div>
        <div class="rec3_mypage">
            <a href="02_2_quest.html" style="width: 0px;">
                <div class="rec4_mypage">
                    <img src="img/ic-quest@2x.png"
                        class="rec4_ic_mypage">
                    <span class="rec4_text_mypage">퀘스트 완료 목록 보기</span>
                    <img src="img/ic-next@2x.png"
                        class="ic_next">
                </div>
            </a>
            <a href="02_1_1_checkPW.html">
                <div class="rec4_mypage">
                    <img src="img/ic-edit@2x.png"
                        class="rec4_ic_mypage">
                    <span class="rec4_text_mypage">회원 정보 수정</span>
                    <img src="img/ic-next@2x.png"
                        class="ic_next">
                </div>
            </a>
            <div class="rec4_mypage" id="logout_mypage">
                <img src="img/ic-logout@2x.png"
                    class="rec4_ic_mypage">
                <span class="rec4_text_mypage">로그아웃</span>
            </div>
        </div>
    </div>
</div>


<!-- 상세 설명 popup -->
<div id="levelLayout">
    <div class="wrapper_popUp">
        <div class="content_popUp">
            <div class="header_popUp">
                <span class="header_title">계급</span>
                <a href="javascript:Close();">
                    <img src="img/ic-clear@2x.png"
                            class="ic_clear">
                </a>
            </div>
            <div class="result_popUp">
                <div class="rec1_mainLevel">
                    <div class="rec1_current5_mainLevel"></div>
                    <div class="rec1_current4_mainLevel"></div>
                    <div class="rec1_current3_mainLevel"></div>
                    <div class="rec1_current2_mainLevel"></div>
                    <div class="rec1_current1_mainLevel"></div>
                </div>
                <div class="rec2_mainLevel">
                    <img src="img/upLine.png"
                            class="upLine">
                </div>
                <div class="rec3_mainLevel">
                    <div class="rec3_level_mainLevel">
                        <img src="img/ic-level-king@2x.png"
                                class="ic_level_king">
                        <div class="rec3_infoBox_mainLevel">
                            <div class="rec3_info1_mainLevel">1계층</div>
                            <div class="rec3_info2_mainLevel">왕</div>
                        </div>
                    </div>
                    <div class="rec3_level_mainLevel">
                        <img src="img/ic-level-gentleman@2x.png"
                                class="ic_level_gentleman">
                        <div class="rec3_infoBox_mainLevel">
                            <div class="rec3_info1_mainLevel">2계층</div>
                            <div class="rec3_info2_mainLevel">양반</div>
                        </div>
                    </div>
                    <div class="rec3_level_mainLevel">
                        <img src="img/ic-level-general@2x.png"
                                class="ic_level_general">
                        <div class="rec3_infoBox_mainLevel">
                            <div class="rec3_info1_mainLevel">3계층</div>
                            <div class="rec3_info2_mainLevel">관리</div>
                        </div>
                    </div>
                    <div class="rec3_level_mainLevel">
                        <img src="img/ic-level-civilian@2x.png"
                                class="ic_level_civilian">
                        <div class="rec3_infoBox_mainLevel">
                            <div class="rec3_info1_mainLevel">4계층</div>
                            <div class="rec3_info2_mainLevel">평민</div>
                        </div>
                    </div>
                    <div class="rec3_level_mainLevel">
                        <img src="img/ic-level-labor@2x.png"
                                class="ic_level_labor">
                        <div class="rec3_infoBox_mainLevel">
                            <div class="rec3_info1_mainLevel">5계층</div>
                            <div class="rec3_info2_mainLevel">노비</div>
                        </div>
                    </div>
                </div>
            </div>
            <a href="javascript:Close();">
                <div class="btn_popUp">
                    <span class="btn_popUp_text">확인</span>
                </div>
            </a>
        </div>
    </div>
</div>

<!-- Optional JavaScript -->
<!-- jQuery first, then Popper.js, then Bootstrap JS -->
    <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>
    <script src="https://code.jquery.com/jquery-3.2.1.min.js"></script>
    <script>
    //달성율 표시 위해 백에 사용자 이메일 넘겨주기 
    $(function(){
        var userID = "id="+ sessionStorage.getItem("id");
        
        $.ajax({
        type: "POST",
        url: "http://13.125.138.168:8080/gungduk/api/v1/finishQuest",
        data: userID,
        async: false,
        success: function(data){
            //계급 이름, 사진 변경과 퍼센테이지 변경
            if ( data.level == 1 ){
                $(".ic_level").attr('src','img/ic-level-labor@2x.png');
                $(".name_current_status").text("노비");
                $(".points_current_status").text(data.percent + "%");
                $(".done_current_status").css({
                    'width': data.percent + "%"
                });
            } else if ( data.level == 2 ){
                $(".ic_level").attr('src','img/ic-level-civilian@2x.png');
                $(".name_current_status").text("평민");
                $(".points_current_status").text(data.percent + "%");
                $(".done_current_status").css({
                    'width': data.percent + "%"
                });
            } else if ( data.level == 3 ){
                $(".ic_level").attr('src','img/ic-level-general@2x.png');
                $(".name_current_status").text("관리");
                $(".points_current_status").text(data.percent + "%");
                $(".done_current_status").css({
                    'width': data.percent + "%"
                });
            } else if ( data.level == 4 ){
                $(".ic_level").attr('src','img/ic-level-gentleman@2x.png');
                $(".name_current_status").text("양반");
                $(".points_current_status").text(data.percent + "%");
                $(".done_current_status").css({
                    'width': data.percent + "%"
                });
            } else if ( data.level == 5 ){
                $(".ic_level").attr('src','img/ic-level-king@2x.png');
                $(".name_current_status").text("왕");
                $(".points_current_status").text(data.percent + "%");
                $(".done_current_status").css({
                    'width': data.percent + "%"
                });
            }
            //계급 이름, 사진 변경과 퍼센테이지 변경
            if ( data.level == 1 ){
                $(".rec1_current1_mainLevel").append("<img src='img/indicator-box@2x.png' class='indicator_box'><div class='rec1_indicatorNm_mainLevel'>현재 계급</div>");
            } else if ( data.level == 2 ){
                $(".rec1_current2_mainLevel").append("<img src='img/indicator-box@2x.png' class='indicator_box'><div class='rec1_indicatorNm_mainLevel'>현재 계급</div>");
            } else if ( data.level == 3 ){
                $(".rec1_current3_mainLevel").append("<img src='img/indicator-box@2x.png' class='indicator_box'><div class='rec1_indicatorNm_mainLevel'>현재 계급</div>");
            } else if ( data.level == 4 ){
                $(".rec1_current4_mainLevel").append("<img src='img/indicator-box@2x.png' class='indicator_box'><div class='rec1_indicatorNm_mainLevel'>현재 계급</div>");
            } else if ( data.level == 5 ){
                $(".rec1_current5_mainLevel").append("<img src='img/indicator-box@2x.png' class='indicator_box'><div class='rec1_indicatorNm_mainLevel'>현재 계급</div>");
            }
            
        }});

        $.ajax({
            type: "POST",
            url: "http://13.125.138.168:8080/gungduk/api/v1/acheive",
            data: userID,
            async: false,
            success: function(data){
                //경복궁 달성률
                $("#gyeongbok_mypage").text(data.gyeongbok+"%");
                $(".rec2_doneG_mypage").css({
                    'width': data.gyeongbok + '%'
                })
                //창경궁 달성률
                $("#changgyeong_mypage").text(data.changgyeong+"%");
                $(".rec2_doneCha_mypage").css({
                    'width': data.changgyeong + '%'
                })
                //덕수궁 달성률
                $("#deoksu_mypage").text(data.deoksu+"%");
                $(".rec2_doneD_mypage").css({
                    'width': data.deoksu + '%'
                })
                //창덕궁 달성률
                $("#changdeok_mypage").text(data.changdeok+"%");
                $(".rec2_doneCdg_mypage").css({
                    'width': data.changdeok + '%'
                })
            },
            error:function(request, error){
                console.log(error.responseText);
                        console.log(request.responseText);
            }
        });
    });
</script>
<script>
//로그아웃 버튼 누르면 로그아웃하고 로그인 페이지로 이동(url과 통신만 되면 로그아웃 됨)
$(function(){
    $("#logout_mypage").click(function(){
        $.ajax({
            type :"GET",
            url: "http://13.125.138.168:8080/gungduk/api/v1/logout",
            async: false,
            contentType : "application/json; charset=utf-8",
            success:function(data){
                location.replace("00_1_login.html");
                sessionStorage.removeItem("id");//세션에서 이메일 삭제
            },
            error:function(request, error){
                console.log(error.responseText);
                    console.log(request.responseText);
            }
        });
    });
});
</script>

</body>
</html>